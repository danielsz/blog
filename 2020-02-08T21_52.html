<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2020-03-09 Mon 13:04 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>The plot against Leiningen</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Daniel Szmulewicz">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="css/grid.css">
<link rel="stylesheet" type="text/css" href="css/post.css">
<link rel="stylesheet" type="text/css" href="assets/fonts/charter/webfonts/stylesheet.css">
<link rel="stylesheet" type="text/css" href="css/typography.css">
<link href="https://fonts.googleapis.com/css?family=Merriweather+Sans|Roboto+Condensed|Source+Serif+Pro|Inconsolata" rel="stylesheet">
<script src="js/grid.js"></script>
<script src="js/analytics.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="index.html"> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content">
<header>
<h1 class="title">The plot against Leiningen</h1>
</header><p>
When we we say that Clojure is hosted on the JVM, we often forget the corollary, that Clojure tooling is built on Maven. We&rsquo;d be forgiven for the oversight: the tooling is good at keeping Maven out of sight. But Maven is and has been lurking in the dark all along. Consider the fact that Leiningen, as its name indicates, emerged as a Maven wrapper. The indication is not so much in the name as in the reference to a short story, <i>Leiningen versus the Ants</i>, echoing the rivalry between Maven and Ant, tools that at one point were competing for mind-share in the Java world.
</p>

<p>
tl;dr It&rsquo;s 2010 and it&rsquo;s <code>mvn install</code>, not <code>lein install</code>
</p>

<p>
Clojars is set up as a Maven repository serving dependencies in the language of Maven coordinates. <code>Pomegranate</code>, the library used by Boot, bills itself as the &ldquo;sane Clojure API for the Maven resolver&rdquo;. <code>tools.deps</code>, introduced two years ago by Cognitect, does its own thing with dependency resolution <i>via</i> the Maven APIs. Start digging underneath any piece of Clojure tooling and you&rsquo;ll soon arrive at Maven.
</p>

<p>
So what is Maven and why is it inescapable? Notably, it advertises itself as project management software, setting itself a scope larger than mere build automation. The notion of a project is taken in its broadest sense, one that includes documentation, version control, reporting, tests, etc. The Project Object Model, or <b>POM</b> in short, codifies a project along all those axes and dimensions. I believe this openendedness is what made Maven such a resilient piece of infrastructure. 
</p>

<p>
The ability to compile Clojure source code from a POM exists since February 2009, when Mark Derricutt pushed the first commit of the Clojure Maven plugin. Leiningen saw the light seven months <b>later</b>. While the latter became the tool of choice in the Clojure community, the Clojure Maven plugin continued to exist in its own timeline. The question imposes itself, what if it were the opposite? What if, circa 2010, Clojure projects were built with <code>mvn install</code> and not <code>lein install</code>? 
</p>

<p>
I think I know how to answer this question because, strangely enough, that alternate history became my reality. Around two years ago, I discovered the ability of <code>tools.deps</code> to generate POM files from a <code>deps.edn</code>. <code>tools.deps</code> was still new but it had already spurred a reconfiguration of practices. Some were happy to ditch the all-in-one build tools of yore in favor of a tailored user-level <code>deps.edn</code>, striving to replace piecemeal the lost functionality. Others were sticking to the traditions, seeing no reason to upset workflows with a proven track record. Initially, I was seduced by carefully assembling specialized tools invoked on the command line, but soon I was at work on something that grew to be an overarching build tool on its own. 
</p>

<p>
The POM files produced by <code>tools.deps</code> were bare bones and unusable as such, but if you tweaked them, and crucially, summoned the Clojure compiler, you could build jars and uberjars straight out the box. What else could you get for free? It turned out: a whole lot. The Maven model is predicated on a build lifecycle with different phases where goals can be attached and executed. To hook into that lifecycle, one writes mojos, a pun on pojos (Maven plain Old Java Object). One or several related mojos packaged together constitute a plugin, and plugins are to be found for nearly every thing that comes to mind due to Maven&rsquo;s penetration and reach. 
</p>

<p>
My strategy was simple but effective: muster desired Maven plugins and coax them in a custom POM that could then be executed via Maven. I named the project <i>Meyvn</i>. The astute reader might note that so far my efforts seem to replicate those of Leiningen: yet another a Maven wrapper. I would concede him the point with the following caveat: Meyvn is a next-gen build tool. With that I mean any tool that incorporates the semantics of <code>deps.edn</code>. By providing an &ldquo;official&rdquo; way to resolve dependencies and populating the classpath, Cognitect&rsquo;s <code>tools.deps</code> drew a line in the sand. 
No judgment is implied on preexisting tools beyond the observation that they wouldn&rsquo;t have been the same had <code>tools.deps</code> been around when they were written. 
</p>

<p>
The <i>checkouts</i> feature illustrates this point aptly. In Leiningen, you need to create a <a href="https://github.com/technomancy/leiningen/blob/83898c0f540345eaa5bc7770835a98c17cff9eb6/doc/TUTORIAL.md#checkout-dependencies">magic</a> directory and symbolic links to extraneous source trees. Boot&rsquo;s <i>checkouts</i> <a href="https://github.com/boot-clj/boot/wiki/Checkout-Dependencies">facility</a> involves a configuration option and a command invocation in the directory of the projects whose source you want to pull. Today, thanks to <code>tools.deps</code>, we have a way to indicate that dependencies are on disk via the <code>:local/root</code> key. When you launch a REPL with Meyvn, it will recognize local dependencies from that notation, track changes that happen in their source trees and reload the project as necessary. 
</p>

<p>
Today, I have no use for Boot nor Leiningen anymore: Meyvn builds and deploys my artifacts. A template system inherited from Maven&rsquo;s archetypes enables kick-starting projects with all the bits and pieces connected. Meyvn has a good story for the web. Specialized mojos implement an asset pipeline: Clojurescript compilation, CSS minification and image compression. The live coding facilities of Meyvn builds on top of Cider. I have already mentioned hot loading for out-of-tree source files, but the Meyvn and its Emacs <a href="https://github.com/danielsz/meyvn-el">client</a> has other features that you can check out. 
</p>

<p>
It is only natural that the release of <code>tools.deps</code> heralded a <a href="https://github.com/clojure/tools.deps.alpha/wiki/Tools">new age</a> of Clojure tooling. That is the effect of introducing richer semantics. As <a href="https://insideclojure.org/2020/02/28/journal/">hinted</a> by Alex Miller, <code>tools.build</code> is coming, and while we don&rsquo;t have the details just yet, I&rsquo;d venture to say that it will further leverage the foundation laid by <code>tools.deps</code>. But it&rsquo;s a level playing field, and practitioners can and should do what artisans have always done: build their own tools. 
</p>

<p>
<b>Note:</b> <a href="https://meyvn.org/">Meyvn</a> is the vehicle through which I am delivering commercial services. As the EULA goes, Meyvn is licensed, not sold. The commercial license bestows on companies the right to host and distribute private software on infrastructure accessible via Meyvn. A non-commercial license is available on request free of charge.
</p>
</div>
</body>
</html>
