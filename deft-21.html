<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2017-12-03 Sun 13:14 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Live coding, take 5</title>
<meta name="generator" content="Org mode">
<meta name="author" content="Daniel Szmulewicz">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="css/grid.css">
<link rel="stylesheet" type="text/css" href="css/post.css">
<link rel="stylesheet" type="text/css" href="assets/fonts/charter/webfonts/stylesheet.css">
<link rel="stylesheet" type="text/css" href="css/typography.css">
<link href="https://fonts.googleapis.com/css?family=Merriweather+Sans|Roboto+Condensed|Source+Serif+Pro|Inconsolata" rel="stylesheet">
<script src="js/grid.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="index.html"> UP </a>
 |
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content">
<header>
<h1 class="title">Live coding, take 5</h1>
</header><p>
Live coding is a methodology and a mindset that lends itself to all kinds of scenarios. When composing music, designing an algorithm or sketching with CSS, instant feedback informs the creator of his ideas while he's nurturing them. The workflow influences the thought process as it's happening. It’s a bottom-up approach, well-known among Lispers, but also by artists of all kinds. Live coding is to programmers what jazz is to musicians, a culture of improvisation, a set of techniques that fluidify the pursuit of a higher goal. 
</p>

<p>
<b>tl;dr</b> Scroll down for a video demonstrating live coding applied to sketching with CSS. 
</p>

<p>
This post is meant to demonstrate the symbiosis between powerful interactive programming environments such as Clojure and Emacs. Emacs is well known to be a glorified interactive environment. Clojure, as a Lisp language, provided a <a href="http://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop">REPL</a> from day one. The tooling around it, on the other hand, took some time to coalesce. In the early days, every IDE came with its own REPL foundation (<a href="https://github.com/EricThorsen/enclojure-repl">enclojure-repl</a>, <a href="https://github.com/technomancy/swank-clojure">swank-clojure</a>, <a href="https://code.google.com/p/counterclockwise/">counterclockwise</a>). Then the nREPL came along—a community effort to standardize protocols and APIs around the REPL. Cider is an Emacs Lisp client that leverages the nREPL to great effect, establishing interoperability between the Clojure and Emacs ecosystems, and offering many tooling opportunities in the process. 
</p>

<p>
Let’s consider <a href="http://www.sketchingwithcss.com/">sketching with CSS</a>, a new and welcome trend in web design that eschews photoshop comps, mockups or prototypes. Instead, the design process takes place in the target medium—the browser—from the get-go. This strategy is sound and cost-effective because it eliminates the need for an intermediary, redundant stage of converting media to and fro authoring tools. 
</p>

<p>
A live coding setup for web applications is not always trivial: code typically runs on the server-side <b>and</b> on the client-side, two environments with which you might want to interact. Known techniques include a plugin called <b><a href="https://github.com/weavejester/lein-ring">lein-ring</a></b>, providing hot reloading when Ring handlers change. Or Stuart Sierra's <a href="http://thinkrelevance.com/blog/2013/06/04/clojure-workflow-reloaded">reloaded</a> workflow, which allows you to refresh your application code at the tip of a keyboard binding. Also, specialized REPLs such as <a href="https://github.com/cemerick/austin">Austin</a> are available for Clojurescript, enabling real-time in-browser interaction. 
</p>

<p>
But sketching with CSS is a simple use case that calls for a simple workflow. All we need is sending a HTML string to a running browser. Emacs Lisper Brian Taylor wrote an extension mode called <a href="http://www.50ply.com/blog/2012/08/13/introducing-impatient-mode/"><b>impatient-mode</b></a>, initially used on buffers with HTML source. Since we’re dealing with Clojure source code and not HTML, I've submitted a <a href="https://github.com/netguy204/imp.el/pull/13">patch</a> that allows to define a user filter on the current buffer, so that transformation to HTML can occur prior to the browser dispatch. The patch has been merged and the functionality is now available in <a href="https://github.com/netguy204/imp.el">master</a>.
</p>

<p>
Here is a demo adapted from the <a href="http://www.youtube.com/watch?v=t6GoK1yGcFM">flexbox tutorial</a> by Sean Firoritto: 
</p>

<p><iframe width="560" height="315" src="https://www.youtube.com/embed/VjBjtuMer2c" frameborder="0" allowfullscreen></iframe></p>

<p>
A quick glance at the github <a href="https://github.com/danielsz/sketching-with-css-in-clojure">repo</a> will reveal a bare minimum setup: only one source file and two dependencies in <b>project.clj</b>. So how is this possible? Hiccup emits HTML strings. Garden emits CSS directives. It's all strings, after all. You still need a Clojure REPL in the background to evaluate your hiccup and garden functions, but that's about it. 
</p>

<p>
If you're going to try this at home, and you should, here are the steps to repeat: 
</p>

<ol class="org-ol">
<li>Clone the repo.</li>
</ol>

<div class="org-src-container">
<pre class="src src-sh">$ git clone git@github.com:danielsz/sketching-with-css-in-clojure.git
$ cd sketching-with-css-in-clojure
$ emacs src/fioritto/sketch.clj
</pre>
</div>

<ol class="org-ol">
<li value="2">In Emacs, start a Clojure REPL, for example <code>M-x cider-jack-in</code> and load the file with <code>C-c C-l</code> or <code>cider-load-file</code>.</li>
<li>Start Emacs's embedded web server. <code>M-x httpd-start</code></li>
<li>With the buffer visiting sketch.clj, start <b>impatient-mode</b>, <code>M-x impatient mode</code>.</li>
<li>Try now: <code>M-x imp-visit-buffer</code>. You will see the buffer in your browser. That's because the default filter for non-html source files is set to <code>htmlize</code>. We'll want to set our own filter for Clojure buffers.</li>
<li>The user filter, a regular Emacs lisp function, can be found in the root folder of the project (sketching.el). Open it and evaluate it (<code>C-M-x</code> or <code>C-x C-e</code>) so that Emacs knows about it. Now <code>M-x imp-set-user-filter</code> and type <b>imp-clj-html</b>.</li>
</ol>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span style="color: #a020f0;">require</span> '<span style="color: #008b8b;">s</span>)

(<span style="color: #a020f0;">defun</span> <span style="color: #0000ff;">imp-clj-html</span> (buffer)
  (<span style="color: #a020f0;">with-current-buffer</span> (get-buffer buffer)
    (cider-eval-defun-at-point))
  (<span style="color: #a020f0;">let*</span> ((content (<span style="color: #a020f0;">with-temp-buffer</span> 
                    (cider-interactive-eval-print <span style="color: #8b2252;">"(fioritto.sketch/page)"</span>)
                    (sleep-for 0.1)
                    (buffer-string)))
         (sanitized-content (s-replace-all '((<span style="color: #8b2252;">"\\n"</span> . <span style="color: #8b2252;">""</span>) (<span style="color: #8b2252;">"\\\""</span> . <span style="color: #8b2252;">"'"</span>)) content)))
    (princ sanitized-content (current-buffer))
    )
  (delete-region (point-min) (+ (point-min) 1))
  (delete-region (- (point-max) 1) (point-max)))
</pre>
</div>

<p>
The secret sauce is <b>cider-interactive-eval-print</b>, which evaluates a Clojure expression and prints its output in an Emacs buffer. In our case, it calls <b>fioritto.sketch/page</b> on the REPL, a HTML emitting function, wich <b>impatient-mode</b> will subsequently send to the browser.
</p>

<ol class="org-ol">
<li value="7">Try again: <code>M-x imp-visit-buffer</code>. Now make changes in your Clojure buffer and witness instant rendering in the browser.</li>
</ol>

<p>
Happy live coding!
</p>
</div>
</body>
</html>
